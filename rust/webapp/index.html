<html>
  <head>

    <style>
    a.canvasjs-chart-credit {
      visibility: hidden;
    }

    body {
      font-family: Arial !important;
      font-size: small;
    }

    .plotTitleOuter {
       height: 150px;
       width: 100px;
    }

    .plotTitleContainer {
       height: 150px;
       width: 100px;
       display: table-cell;
       vertical-align: middle;
    }

    .plotTitle {
       display: inner-block;
       float:right;
       writing-mode: sideways-lr;
       text-orientation: mixed;
       font-weight: bold;
       padding-right: 10px;
       font-size: medium;
    }

    .mainDiv {
      margin: auto;
      display: grid;
      grid-template-rows: auto;
      row-gap: 10px;
    }

    .columnDiv {
      margin: 0;
    }

  .headerRow {
  }

    .bodyRow {
      display: grid;
      grid-template-columns: 800px 800px;
      column-gap: 10px;
  }

    span.boldSpan {
      font-weight: bold;
    }

  .charts {
    display: grid;
    grid-template-rows: auto auto;
    row-gap: 10px;
  }

    .chart {
    height: 250px;
    width: 800px;
    margin: 0px auto;
  }

  </style>

  <title>
  </title>

  </head>
  <body>
    <div class="mainDiv">

      <div class="headerRow">
        <p>Queries Per Second</p>

        <p>
          <input type="range" min="1000" max="1000000" value="10000"
            id="qpsToggle" oninput="qpsValue.value = qpsToggle.value - qpsToggle.value % 10000">
          </br>
          <output id="qpsValue">10000</output>
        </p>

        <p>
          KV Ops per Second: <span class="boldSpan" id="kvOpsPerSec">0</span>
        </p>
      </div> <!-- headerRow -->
    </div> <!-- mainDiv -->

  <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
  <script>
    /*
     * Parameters
     */
    var TILE = 0.99
    var NOW = micros_now();


    /*
     * Set queries per second in the RDB application
     */
    var LAST_QPS = 0;
    function updateQps() {
      var qps = Number(document.getElementById("qpsToggle").value);
      if (qps == LAST_QPS) {
        return;
      }
      LAST_QPS = qps;

      var req = {
        "SetQps": {
          "rate": qps
        }
      }

      var update_fn = function(data) {
        //console.log("Successfully set qps", data);
      };

      send_request(req, update_fn);
    }

    /*
     * Update measured query rate
     */
    function updateKvOpsPerSec() {
      var elem = document.getElementById("kvOpsPerSec");

      var req = "OpsPerSec";

      var update_fn = function(data) {
        elem.innerText = data.OpsPerSec;
      };

      send_request(req, update_fn);
    }

    /*
     * Helper function to send request and call func when request completes
     */
    function send_request(req, func) {
      var request = JSON.stringify(req);
      var request = new Request("http://localhost:3000/dataRequest", {
        method: 'POST',
        body: request,
        headers: new Headers({
            'Content-Type': 'application/json'
        })
      });
      fetch(request)
        .then(data => data.json())
        .then(data => func(data));
    }

    /*
     * Helper functions to get microseconds now
     */
    function micros_now() {
      var nowSecs = Math.floor(Date.now() / 1000);
      return nowSecs * 1000000;
    }

    /*
     * Helper to convert seconds since epoch to a Date object
     */
    function secsToDt(s) {
      var t = new Date(1970, 0, 1); // Epoch
      t.setSeconds(s);
      return t;
    }

    /*
     * Update data and charts every second
     */
    function updateData() {
      updateQps();
      updateKvOpsPerSec();
    }
    setInterval(updateData, 1000);

  </script>
  </body>
</html>
